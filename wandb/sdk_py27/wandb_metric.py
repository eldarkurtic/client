# File is generated by: tox -e codemod
# -*- coding: utf-8 -*-
"""
metric.
"""

import logging

import wandb
from wandb.proto import wandb_internal_pb2 as pb


if wandb.TYPE_CHECKING:
    from typing import Callable, Optional, Sequence, Tuple

logger = logging.getLogger("wandb")


class Metric(object):
    """
    Metric object
    """

    # _callback: Optional[Callable[[pb.MetricRecord], None]]
    # _name: str
    # _step: Optional[str]
    # _auto_step: Optional[bool]
    # _hide: Optional[bool]
    # _summary: Optional[Sequence[str]]

    def __init__(
        self,
        name,
        step = None,
        auto_step = None,
        hide = None,
        summary = None,
        goal = None,
    ):
        self._callback = None
        self._name = name
        self._step = step
        self._auto_step = auto_step
        self._hide = hide
        self._summary = summary
        self._goal = goal

    def _set_callback(self, cb):
        self._callback = cb

    @property
    def name(self):
        return self._name

    @property
    def step(self):
        return self._step

    @property
    def auto_step(self):
        return self._auto_step

    @property
    def summary(self):
        if self._summary is None:
            return None
        return tuple(self._summary)

    @property
    def hide(self):
        return self._hide

    @property
    def goal(self):
        return self._goal

    def _commit(self):
        mr = pb.MetricRecord()
        m = mr.update.add()
        if self._name.endswith("*"):
            m.glob_name = self._name
        else:
            m.name = self._name
        if self._step:
            m.step = self._step
        if self._auto_step:
            m.auto_step = self._auto_step
        if self._hide:
            m.hide = self._hide
        if self._summary:
            summary_set = set(self._summary)
            if "min" in summary_set:
                m.summary.min = True
            if "max" in summary_set:
                m.summary.max = True
            if "mean" in summary_set:
                m.summary.mean = True
            if "best" in summary_set:
                m.summary.best = True
        if self._callback:
            self._callback(mr)
